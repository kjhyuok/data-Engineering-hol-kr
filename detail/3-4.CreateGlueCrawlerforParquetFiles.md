# Lab3-4: Create Glue Crawler for Parquet Files

## PART A: Data Validation and ETL - Create Glue Crawler for Parquet Files<br>

ì´ë²ˆ ë‹¨ê³„ì—ì„œëŠ” ì•„ë˜ Architectureì—ì„œ **â“¹ë²ˆ,â“ºë²ˆ**ì— í•´ë‹¹ë˜ëŠ” Glueì˜ ë§ˆì§€ë§‰ ì‘ì—…ì„ ì‹¤ìŠµí•´ ë´…ë‹ˆë‹¤.\
ì´ ì‹¤ìŠµì„ í†µí•´ ì•ì„œ ë³€ê²½í•œ ParquetíŒŒì¼ì„ *Crawlering*í•˜ì—¬ *Data Catalog*ë¥¼ ìƒì„±í•˜ê³  Databaseì™€ Tableë“¤ì„ Amazon Athenaì—ì„œ í™œìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\
<img src="../images/1-2.png" width="65%" height="65%" title="px(í”½ì…€) í¬ê¸° ì„¤ì •" alt="glue archi"></img><br/>

#### 1.Glue Studio íƒìƒ‰ ë©”ë‰´ì—ì„œ *Crawlers* ì„ íƒí•˜ì—¬ ìƒˆ íƒ­ì—ì„œ Glue Crawlers í˜ì´ì§€ë¥¼ ì—´ê³  *Add crawler*ë¥¼ í´ë¦­í•©ë‹ˆë‹¤.
![3-4-1](../images/glue/cgcpf-1.png)

#### 2. *Crawler name*ì— `glue-lab-parquet-crawler` ë¥¼ ì…ë ¥í•˜ê³  *Next*ë¥¼ í´ë¦­í•©ë‹ˆë‹¤.
![3-4-2](../images/glue/cgcpf-2.png)

#### 3. ë‹¤ìŒ í™”ë©´ *Specify crawler source type*ì—ì„œ *for Crawler source type*ìœ¼ë¡œ *Data Stores*ë¥¼ ì„ íƒí•˜ê³  *Next*ì„ í´ë¦­í•©ë‹ˆë‹¤.

#### 4. data store ì¶”ê°€ í™”ë©´ì—ì„œ
	a. Choose a data storeì—ì„œ S3ë¥¼ ì„ íƒ!
	b. For Crawl data in, select â€œSpecified path in my accountâ€.
	c. Include pathì—ëŠ” parquet íŒŒì¼ì´ í¬í•¨ëœ S3ì˜ ê²½ë¡œë¥¼ ì§€ì •(ìƒìœ„ Parquet í´ë”), (ex> s3://xxx-dmslabs3bucket-xxx/tickets/dms_parquet).
 	d. Next í´ë¦­!
<img src="../images/glue/cgcpf-3.png" width="75%" height="75%" title="px(í”½ì…€) í¬ê¸° ì„¤ì •" alt="glue archi"></img><br/>
<img src="../images/glue/cgcpf-4.png" width="75%" height="75%" title="px(í”½ì…€) í¬ê¸° ì„¤ì •" alt="glue archi"></img><br/>

#### 5. Add another data storeë¥¼ ë¬»ëŠ” í™”ë©´ì—ì„œ *No*ë¥¼ ì„ íƒí•˜ê³  *Next*ë¥¼ í´ë¦­í•©ë‹ˆë‹¤.
![3-4-3](../images/glue/cgcpf-5.png)

#### 6. IAM Role ì„ íƒ í˜ì´ì§€ì—ì„œ *Choose an existing IAM role* ì„ íƒí•©ë‹ˆë‹¤.
	a. IAM roleì€ ê¸°ì¡´ì— ìƒì„±ëœ â€œmod-xxxxx-GlueLabRole-xxxxxâ€ ì„ ì„ íƒ í›„ Next í´ë¦­!
<img src="../images/glue/cgcpf-6.png" width="75%" height="75%" title="px(í”½ì…€) í¬ê¸° ì„¤ì •" alt="glue archi"></img><br/>

#### 7. Frequency ëŒ€í•´ *"Run On Demand"* ì„ ì„ íƒí•˜ê³  *Next*ë¥¼ í´ë¦­í•©ë‹ˆë‹¤.
<img src="../images/glue/cgcpf-7.png" width="75%" height="75%" title="px(í”½ì…€) í¬ê¸° ì„¤ì •" alt="glue archi"></img><br/>

#### 8. crawlerâ€™s output databaseì˜ ê²½ìš° ì´ì „ì— ìƒì„±í•œ ê¸°ì¡´ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì„ íƒí•©ë‹ˆë‹¤. e.g. *ticketdata*
#### 9. Prefix added to tablesì— `parquet_`ë¥¼ ì…ë ¥í•©ë‹ˆë‹¤.
<img src="../images/glue/cgcpf-8.png" width="75%" height="75%" title="px(í”½ì…€) í¬ê¸° ì„¤ì •" alt="glue archi"></img><br/>

#### 10. summary í˜ì´ì§€ë¥¼ ê²€í† í•˜ê³  *Finish* ë¥¼ í´ë¦­í•©ë‹ˆë‹¤.
#### 11. *Run Crawler*ì„ í´ë¦­í•©ë‹ˆë‹¤. Crawlerì‹¤í–‰ì´ ì™„ë£Œë˜ë©´ ì‹¤ìŠµ [3-3.Data Validation and ETL - Data ETL Exercise](../detail/3-3.DataETLExercise.md)ì—ì„œ ì„¤ì •í•œ parquet ETL ë³€í™˜ ê°¯ìˆ˜ì— ë”°ë¼ í…Œì´ë¸”ì´ 1~5ê°œ ê¹Œì§€ ì¶”ê°€ ë˜ì—ˆìŒì„ í™•ì¸ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
![3-4-9](../images/glue/cgcpf-9.png)

### ğŸ‘ğŸ‘ğŸ‘ìˆ˜ê³ í•˜ì…¨ìŠµë‹ˆë‹¤. ì´ì œ 3-x.Glueë¥¼ í™œìš©í•œ ì‹¤ìŠµì„ ëª¨ë‘ ì™„ë£Œ í–ˆìŠµë‹ˆë‹¤.
### ë§ˆì§€ë§‰ìœ¼ë¡œ ë‹¤ìŒ ê²€ì¦ ì‘ì—…ì„ í†µí•´ ìš°ë¦¬ê°€ *Glue Crawler*ë¡œ ì‘ì—…í•œ *parquet table*ë“¤ì´ ì˜¬ë°”ë¥´ê²Œ ìƒì„±ë˜ì—ˆëŠ”ì§€ í™•ì¸í•´ ë´…ë‹ˆë‹¤. ì´ ë°ì´í„°ëŠ” [4.Lab: Query and Visualize](./detail/4.Lab:QueryNVisualize.md)ì‹¤ìŠµì—ì„œ í™œìš© ë©ë‹ˆë‹¤.

ì™¼ìª½ íƒìƒ‰ ì°½ì—ì„œ *Databases > Tables* í´ë¦­í•˜ì—¬, ê²€ìƒ‰ì°½ì— ë‹¤ìŒê³¼ ê°™ì€ Filterë¥¼ ì‚¬ìš©í•˜ì—¬ ì§€ê¸ˆ ìƒˆë¡œë§Œë“  parquet Tableë“¤ì„ í™•ì¸í•´ ë´…ë‹ˆë‹¤.<br>
ê²€ìƒ‰ì°½: `Database = ticketdata`, `Classification = parquet`
ì•„ë˜ì™€ ê°™ì´ ì• ë‹¨ê³„ì—ì„œ ìƒì„±í•œ 5 ê°œì˜ *"parquet_xxx"* tableëª©ë¡ì„ í™•ì¸!.
![3-1](../images/glue/3-1-checkparquet1.png)

<Optional> ì´ì–´ì„œ 5ê°œì˜ parquet tableë“¤ì˜ ê° column data typeì´ ë§ê²Œ ë³€í™˜ë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ê¸° ìœ„í•´ì„œ tableëª©ë¡ ìš°ì¸¡ì˜ **View data** í•­ëª©ì˜ *Table data*ë¥¼ í´ë¦­í•˜ë©´ **Athena Query**ë¥¼ í†µí•´ ë°”ë¡œ tableì†ì„±ê³¼ ë°ì´í„°ë¥¼ queryí•œ ê²°ê³¼ë¥¼ ë³¼ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ê° í…Œì´ë¸”ì˜ **View data** í•­ëª©ì˜ **Table data**ë¥¼ í´ë¦­í•˜ê³  **view** ì°½ì—ì„œ *proceed* ë²„íŠ¼ì„ í´ë¦­í•©ë‹ˆë‹¤.<br>
![3-2](../images/glue/3-1-proceed.png)

ì˜ˆì‹œì™€ ê°™ì´ parquet_personì˜ ì‹¤ì œ ë°ì´í„° ì¿¼ë¦¬ì— ëŒ€í•œ ê²°ê³¼ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìœ¼ë©° í•¸ì¦ˆì˜¨ ê°€ì´ë“œì—ì„œ ë³€í™˜í•´ì•¼í•˜ëŠ” ì»¬ëŸ¼ ì†ì„±ë“¤ì´ ë§ê²Œ ë³€í™˜ë˜ì—ˆëŠ”ì§€ ë¹„êµí•´ì•¼ í•©ë‹ˆë‹¤.<br>
<img src="../images/glue/3-1-athenaqueryresult1.png" width="75%" height="75%" title="px(í”½ì…€) í¬ê¸° ì„¤ì •" alt="glue archi"></img><br/>
<img src="../images/glue/3-1-sportingevent.png" width="75%" height="75%" title="px(í”½ì…€) í¬ê¸° ì„¤ì •" alt="glue archi"></img><br/>
  
ë§Œì•½ ì†ì„±ë“¤ì´ ë§ê²Œ ë³€í™˜ë˜ì§€ ì•Šì€ ê²½ìš° *Glue Studio > Job* ì—ì„œ ì•ì„œ ìƒì„±í•œ jobì„ ì‚­ì œí•˜ê³  ì¬ ìƒì„±í•˜ê±°ë‚˜ *ì˜ëª» ìƒì„± ëœ Jobì„ íƒ(ì²´í¬ë°•ìŠ¤) > Action > Edit Job*ì„ í†µí•´ ì†ì„±ì„ ë§ê²Œ ë³€í™˜ í›„ Jobì„ ì €ì¥í•˜ì„¸ìš”.<br>ê·¸ë¦¬ê³  ë°˜ë“œì‹œ **Run** ì„ ë‹¤ì‹œ ì‹œì‘í•´ì£¼ì„¸ìš”.
*****  
### ë°ì´í„° í™•ì¸ì´ ì™„ë£Œ ë˜ì—ˆë‹¤ë©´ [4.Lab: Query and Visualize](./detail/4.Lab:QueryNVisualize.md)
