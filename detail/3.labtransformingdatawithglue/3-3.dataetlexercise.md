# Lab3-3: Data ETL Exercise

PART A: Data Validation and ETL - Data ETL Exercise



ì‚¬ì „ ì¡°ê±´: ì²˜ë¦¬ëœ ë°ì´í„°ë¥¼ **parquet format**ìœ¼ë¡œ ì €ì¥í•˜ë ¤ë©´ ê° í…Œì´ë¸”ì— ëŒ€í•œ ìƒˆ í´ë” ìœ„ì¹˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.\
ì˜ˆë¥¼ë“¤ì–´ **sport\_team** í…Œì´ë¸”ì˜ ì „ì²´ ê²½ë¡œëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.\
_`s3://<s3_bucket_name>/tickets/dms_parquet/sport_team`_

GlueëŠ” ìœ„ì˜ ì˜ˆì™€ ê°™ì´ ì „ì²´ íŒŒì¼ ê²½ë¡œì˜ ì…ë ¥ì„ ê¸°ë°˜ìœ¼ë¡œ ìƒˆ í´ë”ë¥¼ ìë™ìœ¼ë¡œ ìƒì„±í•©ë‹ˆë‹¤.\
S3 ë²„í‚·ì— ìˆ˜ë™ìœ¼ë¡œ í´ë”ë¥¼ ìƒì„±í•˜ëŠ” ë°©ë²•ì€ [ì‚¬ìš© ì„¤ëª…ì„œ](https://docs.aws.amazon.com/AmazonS3/latest/user-guide/create-folder.html)ë¥¼ ì°¸ì¡°í•´ë³´ì„¸ìš”.\
ì´ë²ˆ ì‹¤ìŠµì€ ì•„ë˜ Architectureì—ì„œ **â“·ë²ˆ,â“¸ë²ˆ**ì— í•´ë‹¹ë˜ëŠ” ë‹¨ê³„ì´ë©°, 5ê°œì˜ CSVí˜•íƒœì˜ ì›ë³¸ Tableì„ Glueì˜ ETLê¸°ëŠ¥ìœ¼ë¡œ Parquetí˜•íƒœ Tableë¡œ ë³€ê²½í•´ ë³´ëŠ” ì‘ì—…ì…ë‹ˆë‹¤.

![glue archi](../../images/1-2.png)


#### 1.ì™¼ìª½ íƒìƒ‰ ì°½ì˜ _ETL ë©”ë‰´_ ì—ì„œ AWS Glue Studioë¥¼ í´ë¦­í•©ë‹ˆë‹¤.

![3-3-1](../../images/glue/dee-1.png)

#### 2. _View jobs_ ì„ ì„ íƒí•´ì£¼ì„¸ìš”.

![3-3-2](../../images/glue/dee-2.png)

#### 3. _Visual with a source and target_ ì˜µì…˜ì„ ì„ íƒí•˜ê³  _Create_ ë¥¼ í´ë¦­í•©ë‹ˆë‹¤.

![3-3-3](../../images/glue/dee-3.png)

#### 4. ì¢Œì¸¡ í‘œì¶œë˜ëŠ” ê·¸ë˜í”„ ìƒë‹¨ì—ì„œ Data source - S3 bucketì„ ì„ íƒí•©ë‹ˆë‹¤.

#### 5. ê·¸ë¦¬ê³  ìš°ì¸¡ _Data source properties - S3_ íŒ¨ë„ì˜ Database ì„ íƒë©”ë‰´ë¥¼ ë“œë¡­ë‹¤ìš´í•˜ì—¬ _`ticketdata`_ ì„ íƒí•©ë‹ˆë‹¤.

#### 6. ê·¸ë¦¬ê³  _`sport_team`_ í…Œì´ë¸”ì„ ì„ íƒí•©ë‹ˆë‹¤.

![3-3-4](../../images/glue/dee-4.png)

#### 7. ì´ë²ˆì—” ì¢Œì¸¡ ê·¸ë˜í”„ ì¤‘ì•™ì— ìˆëŠ” _ApplyMapping_ ë…¸ë“œë¥¼ ì„ íƒí•©ë‹ˆë‹¤. ê·¸ë¦¬ê³  ìš°ì¸¡ _Transform_ íŒ¨ë„ì—ì„œ Source Keyì˜ _id_ ì—´ì˜ \`Data type`ì„ doubleë¡œ ë³€ê²½í•©ë‹ˆë‹¤.

![3-3-5](../../images/glue/dee-5.png)

#### 8. ê·¸ë˜í”„ í•˜ë‹¨ì— ìˆëŠ” _Data target - S3 bucket_ ë…¸ë“œë¥¼ ì„ íƒí•©ë‹ˆë‹¤. ê·¸ë¦¬ê³  ìš°ì¸¡ _Data target properites - S3_ íŒ¨ë„ì—ì„œ Formatì„ ë“œë¡­ë‹¤ìš´í•˜ì—¬ typeì„ Parquetìœ¼ë¡œ ë³€ê²½í•©ë‹ˆë‹¤. ì´ì–´ì„œ ì•„ë˜ì˜ Compression Typeì„ ë“œë¡­ë‹¤ìš´ í•˜ì—¬ Uncompressed ë¥¼ ì„ íƒí•©ë‹ˆë‹¤.

#### 9. S3 Target Locationì—ì„œ Browse S3ë¥¼ ì„ íƒí•˜ê³  _`mod-xxx-dmslabs3bucket-xxx`_ ë²„í‚·ì„ ì°¾ì•„ tickets í´ë”ë¥¼ ì„ íƒí•˜ê³  Choose ë¥¼ ëˆŒëŸ¬ì£¼ì„¸ìš”.

![3-3-6](../../images/glue/dee-6.png)

#### 10. ì•ì„œ ì„ íƒëœ S3ë²„í‚· pathê°€ ì…ë ¥ëœ ê³³ì—ì„œ ì¶”ê°€ì ìœ¼ë¡œ _`dms_parquet/sport_team/`_ ì„ S3 URLì— ì¶”ê°€í•©ë‹ˆë‹¤. 

ê²½ë¡œëŠ” _`s3://mod-xxx-dmslabs3bucket-xxx/tickets/dms_parquet/sport_team/`_ í˜•íƒœì™€ ìœ ì‚¬í•´ì•¼ í•©ë‹ˆë‹¤.

Pathì˜ ëë¶€ë¶„ì— `/`ë¥¼ ìŠì§€ ë§ˆì„¸ìš”. 

![3-3-7](../../images/glue/dee-7.png)

#### 11. ë§ˆì§€ë§‰ìœ¼ë¡œ ì¢Œì¸¡ ìƒë‹¨ì˜ ë©”ì¸ íƒ­ì—ì„œ 3ë²ˆì§¸ _Job details_ ë¥¼ ì„ íƒí•©ë‹ˆë‹¤. Nameì—ëŠ” _`Glue-Lab-SportTeamParquet`_ ì„ ì…ë ¥í•©ë‹ˆë‹¤.

#### 12. _IAM Role_ ì€ _`mod-xxx-GlueLabRole-xxx`_ ì™€ ìœ ì‚¬í•œ ì´ë¦„ì˜ ì—­í• ì„ ì„ íƒí•©ë‹ˆë‹¤.

#### 13. í˜ì´ì§€ë¥¼ ì•„ë˜ë¡œ ìŠ¤í¬ë¡¤í•´ì„œ Job bookmarkë¥¼ ë“œë¡­ë‹¤ìš´í•˜ì—¬ _Disable_ ì„ íƒí•©ë‹ˆë‹¤. ì´ Labì˜ ë’·ë¶€ë¶„ì—ì„œ _Job bookmark_ ê¸°ëŠ¥ì„ ì‚¬ìš©í•´ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

![3-3-8](../../images/glue/dee-8.png)

#### 14. ì˜¤ë¥¸ìª½ ìƒë‹¨ ëª¨ì„œë¦¬ì— ìˆëŠ” _Save_ ë²„íŠ¼ì„ ëˆŒëŸ¬ Jobì„ ìƒì„±í•©ë‹ˆë‹¤.

#### 15. ë°°ë„ˆì— _Successfully created job_ ë©”ì‹œì§€ê°€ í‘œì‹œë˜ë©´ _Run_ ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ _Job_ ì„ ì‹œì‘í•©ë‹ˆë‹¤.

#### 16. ì™¼ìª½ íƒìƒ‰ íŒ¨ë„ì—ì„œ _Jobs_ ì„ íƒí•˜ì—¬ _Job_ ëª©ë¡ì„ í™•ì¸í•©ë‹ˆë‹¤.

#### 17. ì‹¤í–‰ ì¤‘ì¸ jobs, success/failure rates ë° ê¸°íƒ€ ë‹¤ì–‘í•œ statisticsë¥¼ ë³´ë ¤ë©´ ì™¼ìª½ íƒìƒ‰ íŒ¨ë„ì—ì„œ _Monitoring_ ì„ íƒí•©ë‹ˆë‹¤.

![3-3-9](../../images/glue/dee-9.png)

#### 18. _Job runs_ ëª©ë¡ì„ ì•„ë˜ë¡œ ìŠ¤í¬ë¡¤í•˜ì—¬ ETL Jobì´ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤. ì™„ë£Œí•˜ëŠ” ë°ëŠ” ì•½ 1ë¶„ì´ ì†Œìš”ë©ë‹ˆë‹¤.

![3-3-10](../../images/glue/dee-10.png)

#### 19. _sport\_location, sporting\_event, sporting\_event\_ticket ë° person_ í…Œì´ë¸”ì„ ë³€í™˜í•˜ê¸° ìœ„í•´ ì¶”ê°€ 4ê°œì˜ Jobì— ëŒ€í•´ ì´ í”„ë¡œì„¸ìŠ¤ë¥¼ ë°˜ë³µí•´ì•¼ í•©ë‹ˆë‹¤.

ìš°ë¦¬ëŠ” ì´ í”„ë¡œì„¸ìŠ¤ ìˆ˜í–‰í•˜ëŠ” ë™ì•ˆ ë‹¤ë¥¸ column data typesì„ ìˆ˜ì •í•´ì•¼ í•©ë‹ˆë‹¤.\
ê° tableì— ëŒ€í•´ ìœ„ì˜ í”„ë¡œì„¸ìŠ¤ë¥¼ ë°˜ë³µí•˜ê±°ë‚˜ ì²« ë²ˆì§¸ ì‘ì—…ì„ ë³µì œí•˜ê³  ì„¸ë¶€ ì •ë³´ë¥¼ ì—…ë°ì´íŠ¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\
ì•„ë˜ ë‹¨ê³„ì—ì„œëŠ” ì‘ì—…ì„ ë³µì œí•˜ëŠ” ë°©ë²•ì„ ì„¤ëª…í•©ë‹ˆë‹¤.\
ë§Œì•½ ë§¤ë²ˆ ìˆ˜ë™ìœ¼ë¡œ ìƒì„±í•˜ëŠ” ê²½ìš°ì—ëŠ” ìœ„ ë‹¨ê³„ë¥¼ ë”°ë¥´ë˜ ì•„ë˜ í‘œì—ì„œ ì—…ë°ì´íŠ¸ëœ ê°’ì„ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.

a. Jobs ë©”ë‰´ë¡œ ëŒì•„ê°€ì„œ ì•„ê¹Œ ìƒì„±ëœ *Glue-Lab-SportsTeamParquet*ì˜ Check boxë¥¼ ì„ íƒí•˜ê³  ìš°ì¸¡ ìƒë‹¨ ë©”ë‰´ì—ì„œ Actions > Clone jobì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.<br>
b. ê·¸ë¦¬ê³  Save and Runì„ ì„ íƒí•´ ì¤ë‹ˆë‹¤.      

![3-3-11](../../images/glue/dee-11.png)

ğŸ“Œ 19-1. Sport_Location:(ì•„ë˜ì˜ attributesë¥¼ ì‚¬ìš©í•´ì„œ _Glue-Lab-SportLocationParquet_ ì‘ì—…ì„ ìƒì„±í•©ë‹ˆë‹¤.)

| Task / Action                   | Attribute              | Values                                |
| ------------------------------- | ---------------------- | ------------------------------------- |
| â€œData source - S3 bucketâ€ node  | Database               | `ticketdata`                          |
|                                 | Table                  | `sport_location`                      |
| â€œTransform - ApplyMappingâ€ node | Schema transformations | None                                  |
| â€œData target - S3 bucketâ€ node  | Format                 | Parquet                               |
|                                 | Compression Type       | Uncompressed                          |
|                                 | S3 target path         | `tickets/dms_parquet/sport_location/` |
| â€œJob details tabâ€               | Job Name               | `Glue-Lab-SportLocationParquet`       |
|                                 | IAM Role               | xxx-GlueLabRole-xxx                   |
|                                 | Job bookmark           | Disable                               |

ğŸ“Œ 19-2. Sporting_Event:(ì•„ë˜ì˜ attributesë¥¼ ì‚¬ìš©í•´ì„œ _Glue-Lab-SportingEventParquet_ ì‘ì—…ì„ ìƒì„±í•©ë‹ˆë‹¤.)

| Task / Action                   | Attribute                    | Values                                  |
| ------------------------------- | ---------------------------- | --------------------------------------- |
| â€œData source - S3 bucketâ€ node  | Database                     | `ticketdata`                            |
|                                 | Table                        | `sporting_event`                        |
| â€œTransform - ApplyMappingâ€ node | Schema transformations       | column â€œstart\_date\_timeâ€ => TIMESTAMP |
|                                 | column â€œstart\_dateâ€ => DATE |                                         |
| â€œData target - S3 bucketâ€ node  | Format                       | Parquet                                 |
|                                 | Compression Type             | Uncompressed                            |
|                                 | S3 target path               | `tickets/dms_parquet/sporting_event/`   |
| â€œJob details tabâ€               | Job Name                     | `Glue-Lab-SportingEventParquet`         |
|                                 | IAM Role                     | xxx-GlueLabRole-xxx                     |
|                                 | Job bookmark                 | Disable                                 |

ğŸ“Œ 19-3. Sporting_Event_Ticket:(ì•„ë˜ì˜ attributesë¥¼ ì‚¬ìš©í•´ì„œ _Glue-Lab-SportingEventTicketParquet_ ì‘ì—…ì„ ìƒì„±í•©ë‹ˆë‹¤.)

| Task / Action                   | Attribute                              | Values                                       |
| ------------------------------- | -------------------------------------- | -------------------------------------------- |
| â€œData source - S3 bucketâ€ node  | Database                               | `ticketdata`                                 |
|                                 | Table                                  | `sporting_event_ticket`                      |
| â€œTransform - ApplyMappingâ€ node | Schema transformations                 | column â€œidâ€ => DOUBLE                        |
|                                 | column â€œsporting\_event\_idâ€ => DOUBLE |                                              |
|                                 | column â€œticketholder\_idâ€ => DOUBLE    |                                              |
| â€œData target - S3 bucketâ€ node  | Format                                 | Parquet                                      |
|                                 | Compression Type                       | Uncompressed                                 |
|                                 | S3 target path                         | `tickets/dms_parquet/sporting_event_ticket/` |
| â€œJob details tabâ€               | Job Name                               | `Glue-Lab-SportingEventTicketParquet`        |
|                                 | IAM Role                               | xxx-GlueLabRole-xxx                          |
|                                 | Job bookmark                           | Disable                                      |

ğŸ“Œ 19-4. Person:(ì•„ë˜ì˜ attributesë¥¼ ì‚¬ìš©í•´ì„œ _Glue-Lab-PersonParquet_ ì‘ì—…ì„ ìƒì„±í•©ë‹ˆë‹¤.)

| Task / Action                   | Attribute              | Values                        |
| ------------------------------- | ---------------------- | ----------------------------- |
| â€œData source - S3 bucketâ€ node  | Database               | `ticketdata`                  |
|                                 | Table                  | `person`                      |
| â€œTransform - ApplyMappingâ€ node | Schema transformations | column â€œidâ€ => DOUBLE         |
| â€œData target - S3 bucketâ€ node  | Format                 | Parquet                       |
|                                 | Compression Type       | Uncompressed                  |
|                                 | S3 target path         | `tickets/dms_parquet/person/` |
| â€œJob details tabâ€               | Job Name               | `Glue-Lab-PersonParquet`      |
|                                 | IAM Role               | xxx-GlueLabRole-xxx           |
|                                 | Job bookmark           | Disable                       |

ì´ë ‡ê²Œ Glue Jobì„ 4ë²ˆì„ ë°˜ë³µí•˜ì—¬ _sport\_team, sport\_location, sporting\_event, sporting\_event\_ticket ë° person_ ì´ 5ê°œì˜ í…Œì´ë¸”ì— ëŒ€í•´ CSVì—ì„œ Parquet í˜•íƒœë¡œ ë³€ê²½í•˜ì—¬ ì €ì¥í–ˆìŠµë‹ˆë‹¤.\
ì´ì œ ì•„ë˜ë¥¼ í´ë¦­í•˜ì‹œì–´, ë³€ê²½ëœ _Parquet Table_ì„ _Glue Crawler_ë¥¼ í†µí•´ _Data Catalog_ë¡œ ìƒì„±í•´ ë³´ëŠ” ë§ˆì§€ë§‰ Labìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤.\
\
[3-4.Data Validation and ETL - Create Glue Crawler for Parquet Files](3-4.creategluecrawlerforparquetfiles.md)
