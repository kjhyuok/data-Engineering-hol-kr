# Lab3-4: Create Glue Crawler for Parquet Files

PART A: Data Validation and ETL - Create Glue Crawler for Parquet Files\



ì´ë²ˆ ë‹¨ê³„ì—ì„œëŠ” ì•„ë˜ Architectureì—ì„œ **â“¹ë²ˆ,â“ºë²ˆ**ì— í•´ë‹¹ë˜ëŠ” Glueì˜ ë§ˆì§€ë§‰ ì‘ì—…ì„ ì‹¤ìŠµí•´ ë´…ë‹ˆë‹¤.\
ì´ ì‹¤ìŠµì„ í†µí•´ ì•ì„œ ë³€ê²½í•œ ParquetíŒŒì¼ì„ _Crawlering_í•˜ì—¬ _Data Catalog_ë¥¼ ìƒì„±í•˜ê³  Databaseì™€ Tableë“¤ì„ Amazon Athenaì—ì„œ í™œìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

![glue archi](../../images/1-2.png)

#### 1. AWS Glue menuì—ì„œ Crawlersë¥¼ ì„ íƒí•˜ì„¸ìš”.

![3-3](../../images/glue/g-3-1-2.png)

#### 2. Create crawler í´ë¦­í•´ì„œ crawler ì´ë¦„ì„ ë‹¤ìŒ `glue-lab-parquet-crawler` ë¡œ ì…ë ¥í•´ ì£¼ì„¸ìš”.

#### 3. í•„ìš”í•œ ê²½ìš° descriptionì„ ì…ë ¥í•˜ì‹œê³  Nextë¥¼ í´ë¦­í•©ë‹ˆë‹¤.

![3-4-3](../../images/glue/g-3-4-3.png)

#### 4. Step 2ì—ì„œ **Choose data sources and classifiersë¥¼ ì‘ì„±í•´ ë´…ë‹ˆë‹¤.**
ë©”ë‰´ì—ì„œ Add data sourceë¥¼ í´ë¦­!

![3-5-1](../../images/glue/g-3-1-5-1.png)

DMS ì‹¤ìŠµë•Œ ê°€ì ¸ì˜¨ S3 Bucketì„ Browseì—ì„œ ì°¾ì•„ì„œ ì„ íƒí•©ë‹ˆë‹¤. ì´ë•Œ S3 Bucket ë‚´ì— _tickets_ ê¹Œì§€ ì„ íƒí•©ë‹ˆë‹¤.

![3-4-4-2](../../images/glue/g-3-4-4-2.png)
![3-4-4-3](../../images/glue/g-3-4-4-3.png)

S3 Pathì— ì„ íƒëœ S3 Bucket ê²½ë¡œë¥¼ í™•ì¸í•˜ê³  ê·¸ëŒ€ë¡œ Add an S3 data source ë²„íŠ¼ì„ í´ë¦­!

![3-5-4](../../images/glue/g-3-1-5-4.png)

ë³¸ í˜ì´ì§€ì—ì„œ **Choose data sources and classifiers**ë¥¼ í™•ì¸í•˜ê³  Next ë²„íŠ¼ì„ í´ë¦­!

![3-5-5](../../images/glue/g-3-1-5-5.png)

#### 6. Step 3 **Configure security settings** í˜ì´ì§€ì—ì„œ IAM ì„¤ì •ì„ ì•„ë˜ì™€ ê°™ì´ ìˆ˜í–‰í•©ë‹ˆë‹¤.
**IAM role > Existing IAM role** ë©”ë‰´ì—ì„œ Cloudformationì— ì˜í•´ ìë™ ìƒì„±ëœ _mod-xxxx-GlueLabRole-xxxx_ì„ ì„ íƒ

![3-5-6](../../images/glue/g-3-1-6.png)

#### 7. Step 4 **Set output and scheduling** í˜ì´ì§€ì—ì„œ, Target databaseëŠ” ì´ì „ì— ìƒì„±í•œ  ```ticketdata``` ë¡œ ì§€ì •í•˜ê³  *Table name prefix - optional* ì—ëŠ” ```parquet_``` ë¥¼ ì…ë ¥í•´ ì¤ë‹ˆë‹¤.

![3-7-1](../../images/glue/g-3-7-1.png)

í˜ì´ì§€ì—ì„œ ticketdata ë¼ëŠ” ì´ë¦„ì˜ ë°ì´í„°ë² ì´ìŠ¤ê°€ ìƒì„±ëœ ê²ƒì„ í™•ì¸í•˜ê³ , ì´ì „ ì°½(Set output and scheduling ë©”ë‰´)ë¡œ ë³µê·€í•©ë‹ˆë‹¤.
- Target databaseë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ê³  ì´ì „ì— ìƒì„±í•œ ticketdataë¥¼ ì°¾ì•„ì„œ ì„ íƒ!
- ì•„ë˜ì— Crawler scheduleì˜ FrequencyëŠ” On demandë¥¼ ìœ ì§€í•œì±„ Next í´ë¦­!
- 
![3-5-7-2](../../images/glue/g-3-1-7-2.png)

#### 8. Step 5 **Review and create** ì—ì„œ ì§€ê¸ˆê¹Œì§€ ì„¤ì •í•œ ë‚´ìš©ì— ëŒ€í•´ ê²€í†  í›„ Create crawlerë¥¼ í´ë¦­! ì´ì œ crawlerë¥¼ ì‹¤í–‰í•  ì¤€ë¹„ê°€ ë˜ì—ˆìŠµë‹ˆë‹¤.

![3-4-8](../../images/glue/g-3-4-8.png)

#### 9. ë°©ê¸ˆ ìƒì„±í•œ crawler(glue-lab-crawler)ë¥¼ ì²´í¬í•˜ê³  _Run_ ë²„íŠ¼ì„ í´ë¦­í•©ë‹ˆë‹¤.

![3-1-9-1](../../images/glue/g-3-1-9-1.png) 

crawler ìƒíƒœê°€ Start â†’ Stop ìœ¼ë¡œ ë³€ê²½ë˜ê³  crawler ë‹¤ì‹œ Ready ìƒíƒœë¡œ ëŒì•„ì˜¬ ë•Œê¹Œì§€ ê¸°ë‹¤ë¦¬ë©´(ì´ í”„ë¡œì„¸ìŠ¤ëŠ” ëª‡ ë¶„ ì •ë„ ì†Œìš”ë¨) 15ê°œì˜ í…Œì´ë¸”ì´ ìƒì„±ë˜ì—ˆìŒì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤. 

![3-4-10](../../images/glue/g-3-4-10.png) 

#### 10. AWS Glue ì¢Œì¸¡ì˜ íƒìƒ‰ì°½ì—ì„œ, _Databases â†’ Tables_ ì„ íƒí•˜ê³ . ë˜í•œ _ticketdata_ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ í´ë¦­í•´ì„œ í…Œì´ë¸”ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

![3-1-10](../../images/glue/g-3-1-10.png) 









#### 1.Glue Studio íƒìƒ‰ ë©”ë‰´ì—ì„œ _Crawlers_ ì„ íƒí•˜ì—¬ ìƒˆ íƒ­ì—ì„œ Glue Crawlers í˜ì´ì§€ë¥¼ ì—´ê³  _Add crawler_ë¥¼ í´ë¦­í•©ë‹ˆë‹¤.

![3-4-1](../../images/glue/cgcpf-1.png)

#### 2. _Crawler name_ì— `glue-lab-parquet-crawler` ë¥¼ ì…ë ¥í•˜ê³  _Next_ë¥¼ í´ë¦­í•©ë‹ˆë‹¤.

![3-4-2](../../images/glue/cgcpf-2.png)

#### 3. ë‹¤ìŒ í™”ë©´ _Specify crawler source type_ì—ì„œ _for Crawler source type_ìœ¼ë¡œ _Data Stores_ë¥¼ ì„ íƒí•˜ê³  _Next_ì„ í´ë¦­í•©ë‹ˆë‹¤.

#### 4. data store ì¶”ê°€ í™”ë©´ì—ì„œ

a. Choose a data storeì—ì„œ S3ë¥¼ ì„ íƒ!<br>
b. For Crawl data in, select â€œSpecified path in my accountâ€.<br>
c. Include pathì—ëŠ” parquet íŒŒì¼ì´ í¬í•¨ëœ S3ì˜ ê²½ë¡œë¥¼ ì§€ì •(ìƒìœ„ Parquet í´ë”), (ex> s3://xxx-dmslabs3bucket-xxx/tickets/dms_parquet).<br>
d. Next í´ë¦­!

![glue archi](../../images/glue/cgcpf-3.png)

![glue archi](../../images/glue/cgcpf-4.png)

#### 5. Add another data storeë¥¼ ë¬»ëŠ” í™”ë©´ì—ì„œ _No_ë¥¼ ì„ íƒí•˜ê³  _Next_ë¥¼ í´ë¦­í•©ë‹ˆë‹¤.

![3-4-3](../../images/glue/cgcpf-5.png)

#### 6. IAM Role ì„ íƒ í˜ì´ì§€ì—ì„œ _Choose an existing IAM role_ ì„ íƒí•©ë‹ˆë‹¤.

a. IAM roleì€ ê¸°ì¡´ì— ìƒì„±ëœ â€œmod-xxxxx-GlueLabRole-xxxxxâ€ ì„ ì„ íƒ í›„ Next í´ë¦­!

![glue archi](../../images/glue/cgcpf-6.png)


#### 7. Frequency ëŒ€í•´ _"Run On Demand"_ ì„ ì„ íƒí•˜ê³  _Next_ë¥¼ í´ë¦­í•©ë‹ˆë‹¤.


![glue archi](../../images/glue/cgcpf-7.png)


#### 8. crawlerâ€™s output databaseì˜ ê²½ìš° ì´ì „ì— ìƒì„±í•œ ê¸°ì¡´ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì„ íƒí•©ë‹ˆë‹¤. e.g. _ticketdata_

#### 9. Prefix added to tablesì— `parquet_`ë¥¼ ì…ë ¥í•©ë‹ˆë‹¤.


![glue archi](../../images/glue/cgcpf-8.png)


#### 10. summary í˜ì´ì§€ë¥¼ ê²€í† í•˜ê³  _Finish_ ë¥¼ í´ë¦­í•©ë‹ˆë‹¤.

#### 11. _Run Crawler_ì„ í´ë¦­í•©ë‹ˆë‹¤. Crawlerì‹¤í–‰ì´ ì™„ë£Œë˜ë©´ ì‹¤ìŠµ [3-3.Data Validation and ETL - Data ETL Exercise](3-3.dataetlexercise.md)ì—ì„œ ì„¤ì •í•œ parquet ETL ë³€í™˜ ê°¯ìˆ˜ì— ë”°ë¼ í…Œì´ë¸”ì´ 1\~5ê°œ ê¹Œì§€ ì¶”ê°€ ë˜ì—ˆìŒì„ í™•ì¸ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

![3-4-9](../../images/glue/cgcpf-9.png)

### ğŸ‘ğŸ‘ğŸ‘ìˆ˜ê³ í•˜ì…¨ìŠµë‹ˆë‹¤. ì´ì œ 3-x.Glueë¥¼ í™œìš©í•œ ì‹¤ìŠµì„ ëª¨ë‘ ì™„ë£Œ í–ˆìŠµë‹ˆë‹¤.

### ë§ˆì§€ë§‰ìœ¼ë¡œ ë‹¤ìŒ ê²€ì¦ ì‘ì—…ì„ í†µí•´ ìš°ë¦¬ê°€ _Glue Crawler_ë¡œ ì‘ì—…í•œ _parquet table_ë“¤ì´ ì˜¬ë°”ë¥´ê²Œ ìƒì„±ë˜ì—ˆëŠ”ì§€ í™•ì¸í•´ ë´…ë‹ˆë‹¤. ì´ ë°ì´í„°ëŠ” [4.Lab: Query and Visualize](../4.lab-querynvisualize/)ì‹¤ìŠµì—ì„œ í™œìš© ë©ë‹ˆë‹¤.

ì™¼ìª½ íƒìƒ‰ ì°½ì—ì„œ _Databases > Tables_ í´ë¦­í•˜ì—¬, ê²€ìƒ‰ì°½ì— ë‹¤ìŒê³¼ ê°™ì€ Filterë¥¼ ì‚¬ìš©í•˜ì—¬ ì§€ê¸ˆ ìƒˆë¡œë§Œë“  parquet Tableë“¤ì„ í™•ì¸í•´ ë´…ë‹ˆë‹¤.\
ê²€ìƒ‰ì°½: `Database = ticketdata`, `Classification = parquet` ì•„ë˜ì™€ ê°™ì´ ì• ë‹¨ê³„ì—ì„œ ìƒì„±í•œ 5 ê°œì˜ _"parquet\_xxx"_ tableëª©ë¡ì„ í™•ì¸!. 

![3-1](../../images/glue/3-1-checkparquet1.png)

ì´ì–´ì„œ 5ê°œì˜ parquet tableë“¤ì˜ ê° column data typeì´ ë§ê²Œ ë³€í™˜ë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ê¸° ìœ„í•´ì„œ tableëª©ë¡ ìš°ì¸¡ì˜ **View data** í•­ëª©ì˜ _Table data_ë¥¼ í´ë¦­í•˜ë©´ **Athena Query**ë¥¼ í†µí•´ ë°”ë¡œ tableì†ì„±ê³¼ ë°ì´í„°ë¥¼ queryí•œ ê²°ê³¼ë¥¼ ë³¼ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê° í…Œì´ë¸”ì˜ **View data** í•­ëª©ì˜ **Table data**ë¥¼ í´ë¦­í•˜ê³  **view** ì°½ì—ì„œ _proceed_ ë²„íŠ¼ì„ í´ë¦­í•©ë‹ˆë‹¤.

![3-2](../../images/glue/3-1-proceed.png)

parquet\_personì˜ ì‹¤ì œ ë°ì´í„° ì¿¼ë¦¬ì— ëŒ€í•œ ê²°ê³¼ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìœ¼ë©° í•¸ì¦ˆì˜¨ ê°€ì´ë“œì—ì„œ ë³€í™˜í•´ì•¼í•˜ëŠ” ì»¬ëŸ¼ ì†ì„±ë“¤ì´ ë§ê²Œ ë³€í™˜ë˜ì—ˆëŠ”ì§€ ë¹„êµí•´ì•¼ í•©ë‹ˆë‹¤.\
ì¤‘ìš”> ì´ ë•Œ Athenaë¥¼ í†µí•´ ìˆ˜í–‰ë˜ëŠ” ì¿¼ë¦¬ë¥¼ ì €ì¥í•  S3 ìœ„ì¹˜ë¥¼ ì¶”ê°€í•´ ì¤ë‹ˆë‹¤. 

![glue archi](../../images/glue/3-1-athenaqueryresult1.png)

![glue archi](../../images/glue/3-1-sportingevent.png)


ë§Œì•½ ì†ì„±ë“¤ì´ ë§ê²Œ ë³€í™˜ë˜ì§€ ì•Šì€ ê²½ìš° _Glue Studio > Job_ ì—ì„œ ì•ì„œ ìƒì„±í•œ jobì„ ì‚­ì œí•˜ê³  ì¬ ìƒì„±í•˜ê±°ë‚˜ _ì˜ëª» ìƒì„± ëœ Jobì„ íƒ(ì²´í¬ë°•ìŠ¤) > Action > Edit Job_ì„ í†µí•´ ì†ì„±ì„ ë§ê²Œ ë³€í™˜ í›„ Jobì„ ì €ì¥í•˜ì„¸ìš”.\
ê·¸ë¦¬ê³  ë°˜ë“œì‹œ **Run** ì„ ë‹¤ì‹œ ì‹œì‘í•´ì£¼ì„¸ìš”.

***

### ë°ì´í„° í™•ì¸ì´ ì™„ë£Œ ë˜ì—ˆë‹¤ë©´ [4.Lab: Query and Visualize](../4.lab-querynvisualize/)
